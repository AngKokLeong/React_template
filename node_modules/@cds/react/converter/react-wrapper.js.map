{"version":3,"file":"react-wrapper.js","sourceRoot":"","sources":["../../../src/converter/react-wrapper.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\n\n/**\n * This is a copy of the new lit-element React wrapper that is not yet published to npm.\n * This combined the lit-element version with a couple of improvements for the TS and DevTool debugging\n * from the original wrapper API. Once this is published and are able to preserve\n * the improved types we should be able to delete this file in favor of using the npm package.\n *\n * https://github.com/Polymer/lit-html/blob/lit-next/packages/labs/react/src/test/create-component_test.ts\n * http://polymer.github.io/LICENSE.txt\n */\n\nconst reservedReactProperties = new Set(['children', 'localName', 'ref', 'style', 'className']);\n\nconst listenedEvents: WeakMap<Element, Map<string, EventListenerObject>> = new WeakMap();\n\n/**\n * Adds an event listener for the specified event to the given node. In the\n * React setup, there should only ever be one event listener. Thus, for\n * efficiency only one listener is added and the handler for that listener is\n * updated to point to the given listener function.\n */\nconst addOrUpdateEventListener = (node: Element, event: string, listener: (event?: Event) => void) => {\n  let events = listenedEvents.get(node);\n  if (events === undefined) {\n    listenedEvents.set(node, (events = new Map()));\n  }\n  let handler = events.get(event);\n  if (listener !== undefined) {\n    // If necessary, add listener and track handler\n    if (handler === undefined) {\n      events.set(event, (handler = { handleEvent: listener }));\n      node.addEventListener(event, handler);\n      // Otherwise just update the listener with new value\n    } else {\n      handler.handleEvent = listener;\n    }\n    // Remove listener if one exists and value is undefined\n  } else if (handler !== undefined) {\n    events.delete(event);\n    node.removeEventListener(event, handler);\n  }\n};\n\n/**\n * Sets properties and events on custom elements. These properties and events\n * have been pre-filtered so we know they should apply to the custom element.\n */\nconst setProperty = <E extends Element, T>(\n  node: E,\n  name: string,\n  value: unknown,\n  old: unknown,\n  events?: StringValued<T>\n) => {\n  const event = events?.[name as keyof T];\n  if (event !== undefined) {\n    // Dirty check event value.\n    if (value !== old) {\n      addOrUpdateEventListener(node, event, value as (e?: Event) => void);\n    }\n  } else {\n    // But don't dirty check properties; elements are assumed to do this.\n    node[name as keyof E] = value as E[keyof E];\n  }\n};\n\n// Set a React ref. Note, there are 2 kinds of refs and there's no built in\n// React API to set a ref.\nconst setRef = (ref: React.Ref<unknown>, value: Element | null) => {\n  if (typeof ref === 'function') {\n    (ref as (e: Element | null) => void)(value);\n  } else {\n    (ref as { current: Element | null }).current = value;\n  }\n};\n\ntype Events<S> = {\n  [P in keyof S]?: (e: Event) => unknown;\n};\n\ntype StringValued<T> = {\n  [P in keyof T]: string;\n};\n\ntype Constructor<T> = { new (): T };\n\n/**\n * Creates a React component for a custom element. Properties are distinguished\n * from attributes automatically, and events can be configured so they are\n * added to the custom element as event listeners.\n *\n * @param React The React module, typically imported from the `react` npm\n * package.\n * @param tagName The custom element tag name registered via\n * `customElements.define`.\n * @param elementClass The custom element class registered via\n * `customElements.define`.\n * @param events An object listing events to which the component can listen. The\n * object keys are the event property names passed in via React props and the\n * object values are the names of the corresponding events generated by the\n * custom element. For example, given `{onactivate: 'activate'}` an event\n * function may be passed via the component's `onactivate` prop and will be\n * called when the custom element fires its `activate` event.\n */\nexport const createComponent = <I extends HTMLElement, E>(\n  tagName: string,\n  elementClass: Constructor<I>,\n  events?: StringValued<E>\n) => {\n  const Component = React.Component;\n  const createElement = React.createElement;\n\n  // Props the user is allowed to use, includes standard attributes, children,\n  // ref, as well as special event and element properties.\n  // type UserProps = React.PropsWithChildren<\n  //   React.PropsWithRef<Partial<I> & Events<E>>\n  // >;\n  type UserProps = Partial<Omit<I, 'children'> & React.DOMAttributes<HTMLElement> & Events<E>>; // modification for children types and deprecated nativeElement - Cory\n\n  // Props used by this component wrapper. This is the UserProps and the\n  // special `__forwardedRef` property. Note, this ref is special because\n  // it's both needed in this component to get access to the rendered element\n  // and must fulfill any ref passed by the user.\n  type ComponentProps = UserProps & {\n    __forwardedRef?: React.Ref<unknown>;\n  };\n\n  // Set of properties/events which should be specially handled by the wrapper\n  // and not handled directly by React.\n  const elementClassProps = new Set(Object.keys(events ?? {}));\n  for (const p in elementClass.prototype) {\n    if (!(p in HTMLElement.prototype)) {\n      if (reservedReactProperties.has(p)) {\n        // Note, this effectively warns only for `ref` since the other\n        // reserved props are on HTMLElement.prototype. To address this\n        // would require crawling down the prototype, which doesn't feel worth\n        // it since implementing these properties on an element is extremely\n        // rare.\n        console.warn(\n          `${tagName} contains property ${p} which is a React ` +\n            `reserved property. It will be used by React and not set on ` +\n            `the element.`\n        );\n      } else {\n        elementClassProps.add(p);\n      }\n    }\n  }\n\n  const componentName = tagName\n    .replace(/\\s*-\\s*\\w/g, c => c[c.length - 1].toUpperCase())\n    .replace(/^\\w/, s => s.toUpperCase());\n  class ReactComponent extends Component<ComponentProps> {\n    static displayName = `${tagName}(CustomElement)`; // edit to preserve component name in DevTools - Cory\n    private _element: I | null = null;\n    private _elementProps!: { [index: string]: unknown };\n    private _userRef?: React.Ref<unknown>;\n    private _ref?: React.RefCallback<I>;\n\n    private _updateElement(oldProps?: ComponentProps) {\n      if (this._element === null) {\n        return;\n      }\n      // Set element properties to the values in `this.props`\n      for (const prop in this._elementProps) {\n        setProperty(\n          this._element,\n          prop,\n          this.props[prop as keyof ComponentProps],\n          oldProps ? (oldProps as any)[prop] : undefined, // edit, cast to any as it causes error TS2590 - Cory\n          events\n        );\n      }\n      // Note, the spirit of React might be to \"unset\" any old values that\n      // are no longer included; however, there's no reasonable value to set\n      // them to so we just leave the previous state as is.\n    }\n\n    /**\n     * Updates element properties correctly setting properties\n     * on mount.\n     */\n    componentDidMount() {\n      this._updateElement();\n\n      // cory: log react version to Core global service\n      if ((window as any).CDS && !(window as any).CDS._react.version) {\n        (window as any).CDS._react.version = React.version;\n      }\n    }\n\n    /**\n     * Updates element properties correctly setting properties\n     * on every update. Note, this does not include mount.\n     */\n    componentDidUpdate(old: ComponentProps) {\n      this._updateElement(old);\n    }\n\n    /**\n     * Renders the custom element with a `ref` prop which allows this\n     * component to reference the custom element.\n     *\n     * Standard attributes are passed to React and element properties and events\n     * are updated in componentDidMount/componentDidUpdate.\n     *\n     */\n    render() {\n      // Since refs only get fulfilled once, pass a new one if the user's\n      // ref changed. This allows refs to be fulfilled as expected, going from\n      // having a value to null.\n      const userRef = this.props.__forwardedRef as React.Ref<unknown>;\n      if (this._ref === undefined || this._userRef !== userRef) {\n        this._ref = (value: I | null) => {\n          if (this._element === null) {\n            this._element = value;\n\n            Object.defineProperty(this._element, 'nativeElement', {\n              get: () => new Promise(r => r(this._element)),\n            });\n          }\n          if (userRef !== null) {\n            setRef(userRef, value);\n          }\n          this._userRef = userRef;\n        };\n      }\n      // Filters class properties out and passes the remaining\n      // attributes to React. This allows attributes to use framework rules\n      // for setting attributes and render correctly under SSR.\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const props: any = { ref: this._ref };\n      // Note, save element props while iterating to avoid the need to\n      // iterate again when setting properties.\n      this._elementProps = {};\n      for (const [k, v] of Object.entries(this.props)) {\n        if (elementClassProps.has(k)) {\n          this._elementProps[k] = v;\n        } else {\n          // React does *not* handle `className` for custom elements so\n          // coerce it to `class` so it's handled correctly.\n          props[k === 'className' ? 'class' : k] = v;\n        }\n      }\n      return createElement(tagName, props);\n    }\n  }\n\n  const element = React.forwardRef((props?: UserProps, ref?: React.Ref<unknown>) =>\n    createElement(ReactComponent, { ...props, __forwardedRef: ref } as any, props?.children)\n  );\n\n  element.displayName = `${componentName}`; // edit to preserve component name in DevTools - Cory\n  return element;\n};\n"]}